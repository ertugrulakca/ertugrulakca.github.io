<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Mongoose Schema Validation</title>
</head>
<body>
  <h1>Mongoose Schema Validation</h1>
  <p>Date: 2024-10-24 10:30:00 +0300</p>

  <p>Date: 2024-10-24 10:30:00 +0300</p>

  <article>
    <h2>Sorting</h2>
    <pre><code>const books = await Book.find({}).sort({title:1}); // ASC
const books = await Book.find({}).sort({title:-1}); // DESC</code></pre>

    <h2>Limit</h2>
    <pre><code>const books = await Book.find({}).sort({title:-1}).limit(2);</code></pre>

    <h2>Skip</h2>
    <p>Skip first n record</p>
    <pre><code>const books = await Book.find({}).sort({title:1}).skip(2).limit(2);</code></pre>

    <h2>$match</h2>
    <pre><code>const books = await Book.aggregate([
    {
        $match: {
            title: 'a'
        }
    }
]);</code></pre>

    <h2>$group</h2>
    <p>Sum</p>
    <pre><code>const books = await Book.aggregate([
    {
        $group: {
            _id: '$title',
            myCount: { $sum: 1 }
        }
    }
]);</code></pre>

    <h2>$project</h2>
    <pre><code>router.get('/', async function(req, res, next) {
    const books = await Book.aggregate([
        {
            $project: {
                title: 1
            }
        }
    ]);

    res.json(books);
});</code></pre>

    <h2>$sort, $limit, $skip</h2>
    <pre><code>router.get('/', async function(req, res, next) {
    const books = await Book.aggregate([
        {
            $project: {
                title: 1
            }
        },
        {
            $sort: {
                title: -1
            }
        },
        {
            $limit: 5
        },
        {
            $skip: 2
        }
    ]);

    res.json(books);
});</code></pre>

    <h2>$lookup</h2>
    <pre><code>db.users.insertOne({name: 'John', username: 'johndoe'})
db.books.insertOne({title: 'Foo', userId: ObjectId('6719ef784f09ffb8a481d77c')})</code></pre>

    <pre><code>const books = await Book.aggregate([
    {
        $lookup: {
            from: 'users',
            localField: 'userId',
            foreignField: '_id',
            as: 'user'
        }
    }
]);</code></pre>

    <h2>$unwind</h2>
    <p>Extract to a user object. Field include and exclude with $project.</p>
    <pre><code>const books = await Book.aggregate([
    {
        $lookup: {
            from: 'users',
            localField: 'userId',
            foreignField: '_id',
            as: 'user'
        }
    },
    {
        $unwind: '$user'
    },
    {
        $project: {
            title: 1,
            username: '$user.username',
        }
    }
]);</code></pre>
  </article>

  <p>
    <a href="/blogs/index.html">Back to blog index</a> |
    <a href="/index.html">Back to CV</a>
  </p>
</body>
</html>

