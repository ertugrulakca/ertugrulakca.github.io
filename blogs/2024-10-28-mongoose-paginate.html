<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Mongoose Paginate</title>
</head>
<body>
  <h1>Mongoose Paginate</h1>
  <p>Date: 2024-10-28 22:30:00 +0300</p>

  <p>Date: 2024-10-28 22:30:00 +0300</p>

  <article>
    <h2>Custom</h2>
    <pre><code>const page = req.query.page > 0 ? (req.query.page ?? 1) : 1;
const limit = req.query.limit ?? 50;
const offset = (page - 1) * limit;

const movies = await Movie.aggregate([
    {
        $project: {
            title: true,
            year: true,
            imdb: true,
            poster: true
        }
    },
    {
        $skip: offset
    },
    {
        $limit: limit
    }
]);

res.render('movies/index', {movies});</code></pre>

    <h2>With Module (mongoose-paginate)</h2>
    <pre><code>npm install mongoose-paginate</code></pre>

    <h3>Schema</h3>
    <pre><code>const mongoose = require('mongoose');
const mongoosePaginate = require('mongoose-paginate-v2'); // add this line

const Schema = mongoose.Schema;

const MovieSchema = new Schema({
    title: {
        type: String,
        required: true,
    },
    plot: {
        type: String,
    },
    poster: String,
    year: Number,
    imdb: Object,
    directors: Array,
    released: Date
}).plugin(mongoosePaginate); // add this line


module.exports = mongoose.model('movies', MovieSchema);</code></pre>

    <h3>Controller</h3>
    <pre><code>const page = req.query.page ?? 1;
const limit = req.query.limit ?? 15;
const search = req.query.search ?? '';
const filter = {};

if (search) {
    filter.title = {$regex: `${search}`};
}

const movies = await Movie.paginate(filter, {
    page,
    limit,
    projection: {title: 1, year: 1, poster: 1, imdb: 1}
}).then({});</code></pre>
  </article>

  <p>
    <a href="/blogs/index.html">Back to blog index</a> |
    <a href="/index.html">Back to CV</a>
  </p>
</body>
</html>

